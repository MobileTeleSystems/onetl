
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../../assets/images/icon.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Read - onETL Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/autodoc_pydantic.css">
    
      <link rel="stylesheet" href="../../../../assets/mkdocs_puml/puml.css">
    
      <link rel="stylesheet" href="../../../../assets/mkdocs_puml/interaction.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reading-from-greenplum-using-dbreader" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="onETL Docs" class="md-header__button md-logo" aria-label="onETL Docs" data-md-component="logo">
      
  <img src="../../../../assets/images/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            onETL Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Read
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/en/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/ru/" hreflang="ru" class="md-select__link">
              Русский
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="onETL Docs" class="md-nav__button md-logo" aria-label="onETL Docs" data-md-component="logo">
      
  <img src="../../../../assets/images/logo.svg" alt="logo">

    </a>
    onETL Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../quickstart" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../logging" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../security" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../contributing" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../plugins" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plugins
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../changelog/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    changelog
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            changelog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.13.4" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.13.4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.13.3" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.13.3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.13.1" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.13.1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.13.0" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.13.0
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.12.5" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.12.5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.12.4" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.12.4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.12.3" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.12.3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.12.2" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.12.2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.12.1" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.12.1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.12.0" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.12.0
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.11.2" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.11.2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.11.1" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.11.1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.11.0" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.11.0
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.10.2" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.10.2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.10.1" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.10.1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.10.0" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.10.0
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.9.5" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.9.5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.9.4" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.9.4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.9.3" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.9.3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.9.2" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.9.2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.9.1" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.9.1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.9.0" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.9.0
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.8.1" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.8.1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.8.0" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.8.0
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.7.2" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.7.2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.7.1" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.7.1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/0.7.0" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    0.7.0
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../db_/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    DB
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            DB
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../db_/reader" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DBReader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../db_/writer" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DBWriter
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#supported-dbreader-features" class="md-nav__link">
    <span class="md-ellipsis">
      Supported DBReader features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interaction-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Interaction schema
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommendations" class="md-nav__link">
    <span class="md-ellipsis">
      Recommendations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#select-only-required-columns" class="md-nav__link">
    <span class="md-ellipsis">
      Select only required columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pay-attention-to-where-value" class="md-nav__link">
    <span class="md-ellipsis">
      Pay attention to where value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read-data-in-parallel" class="md-nav__link">
    <span class="md-ellipsis">
      Read data in parallel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Read data in parallel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-gp_segment_id" class="md-nav__link">
    <span class="md-ellipsis">
      Using gp_segment_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-custom-partition_column" class="md-nav__link">
    <span class="md-ellipsis">
      Using custom partition_column
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reading-distributed-replicated-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Reading DISTRIBUTED REPLICATED tables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallel-join-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Parallel JOIN execution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Parallel JOIN execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#temporary-tables-notice" class="md-nav__link">
    <span class="md-ellipsis">
      TEMPORARY tables notice
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    <span class="md-ellipsis">
      Options
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<p>(greenplum-read)=</p>
<h1 id="reading-from-greenplum-using-dbreader">Reading from Greenplum using <code>DBReader</code><a class="headerlink" href="#reading-from-greenplum-using-dbreader" title="Permanent link">&para;</a></h1>
<p>Data can be read from Greenplum to Spark using {obj}<code>DBReader &lt;onetl.db.db_reader.db_reader.DBReader&gt;</code>.
It also supports {ref}<code>strategy</code> for incremental data reading.</p>
<div class="highlight"><pre><span></span><code>.. warning::

    Please take into account :ref:`greenplum-types`.
</code></pre></div>
<div class="highlight"><pre><span></span><code>.. note::

    Unlike JDBC connectors, *Greenplum connector for Spark* does not support
    executing **custom** SQL queries using ``.sql`` method. Connector can be used to only read data from a table or view.
</code></pre></div>
<h2 id="supported-dbreader-features">Supported DBReader features<a class="headerlink" href="#supported-dbreader-features" title="Permanent link">&para;</a></h2>
<ul>
<li>✅︎ <code>columns</code> (see note below)</li>
<li>✅︎ <code>where</code> (see note below)</li>
<li>✅︎ <code>hwm</code> (see note below), supported strategies:</li>
<li>
<ul>
<li>✅︎ {ref}<code>snapshot-strategy</code></li>
</ul>
</li>
<li>
<ul>
<li>✅︎ {ref}<code>incremental-strategy</code></li>
</ul>
</li>
<li>
<ul>
<li>✅︎ {ref}<code>snapshot-batch-strategy</code></li>
</ul>
</li>
<li>
<ul>
<li>✅︎ {ref}<code>incremental-batch-strategy</code></li>
</ul>
</li>
<li>❌ <code>hint</code> (is not supported by Greenplum)</li>
<li>❌ <code>df_schema</code></li>
<li>✅︎ <code>options</code> (see {obj}<code>Greenplum.ReadOptions &lt;onetl.connection.db_connection.greenplum.options.GreenplumReadOptions&gt;</code>)</li>
</ul>
<div class="highlight"><pre><span></span><code>.. warning::

    In case of Greenplum connector, ``DBReader`` does not generate raw ``SELECT`` query. Instead it relies on Spark SQL syntax
    which in some cases (using column projection and predicate pushdown) can be converted to Greenplum SQL.

    So ``columns``, ``where`` and ``hwm.expression`` should be specified in `Spark SQL &lt;https://spark.apache.org/docs/latest/sql-ref-syntax.html&gt;`_ syntax,
    not Greenplum SQL.

    This is OK:

    .. code-block:: python

        DBReader(
            columns=[
                &quot;some_column&quot;,
                # this cast is executed on Spark side
                &quot;CAST(another_column AS STRING)&quot;,
            ],
            # this predicate is parsed by Spark, and can be pushed down to Greenplum
            where=&quot;some_column LIKE &#39;val1%&#39;&quot;,
        )

    This is will fail:

    .. code-block:: python

        DBReader(
            columns=[
                &quot;some_column&quot;,
                # Spark does not have `text` type
                &quot;CAST(another_column AS text)&quot;,
            ],
            # Spark does not support ~ syntax for regexp matching
            where=&quot;some_column ~ &#39;val1.*&#39;&quot;,
        )
</code></pre></div>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h2>
<p>Snapshot strategy:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">onetl.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">Greenplum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">onetl.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">DBReader</span>

<span class="n">greenplum</span> <span class="o">=</span> <span class="n">Greenplum</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">reader</span> <span class="o">=</span> <span class="n">DBReader</span><span class="p">(</span>
    <span class="n">connection</span><span class="o">=</span><span class="n">greenplum</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;schema.table&quot;</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="s2">&quot;CAST(value AS string) value&quot;</span><span class="p">,</span> <span class="s2">&quot;updated_dt&quot;</span><span class="p">],</span>
    <span class="n">where</span><span class="o">=</span><span class="s2">&quot;key = &#39;something&#39;&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>
<p>Incremental strategy:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">onetl.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">Greenplum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">onetl.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">DBReader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">onetl.strategy</span><span class="w"> </span><span class="kn">import</span> <span class="n">IncrementalStrategy</span>

<span class="n">greenplum</span> <span class="o">=</span> <span class="n">Greenplum</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">reader</span> <span class="o">=</span> <span class="n">DBReader</span><span class="p">(</span>
    <span class="n">connection</span><span class="o">=</span><span class="n">greenplum</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;schema.table&quot;</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="s2">&quot;CAST(value AS string) value&quot;</span><span class="p">,</span> <span class="s2">&quot;updated_dt&quot;</span><span class="p">],</span>
    <span class="n">where</span><span class="o">=</span><span class="s2">&quot;key = &#39;something&#39;&quot;</span><span class="p">,</span>
    <span class="n">hwm</span><span class="o">=</span><span class="n">DBReader</span><span class="o">.</span><span class="n">AutoDetectHWM</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;greenplum_hwm&quot;</span><span class="p">,</span> <span class="n">expression</span><span class="o">=</span><span class="s2">&quot;updated_dt&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">IncrementalStrategy</span><span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>
<h2 id="interaction-schema">Interaction schema<a class="headerlink" href="#interaction-schema" title="Permanent link">&para;</a></h2>
<p>High-level schema is described in {ref}<code>greenplum-prerequisites</code>. You can find detailed interaction schema below.</p>
<div class="highlight"><pre><span></span><code>.. dropdown:: Spark &lt;-&gt; Greenplum interaction during DBReader.run()

    .. plantuml::

        @startuml
        title Greenplum master &lt;-&gt; Spark driver
                box &quot;Spark&quot;
                participant &quot;Spark driver&quot;
                participant &quot;Spark executor1&quot;
                participant &quot;Spark executor2&quot;
                participant &quot;Spark executorN&quot;
                end box

                box &quot;Greenplum&quot;
                participant &quot;Greenplum master&quot;
                participant &quot;Greenplum segment1&quot;
                participant &quot;Greenplum segment2&quot;
                participant &quot;Greenplum segmentN&quot;
                end box

                == Greenplum.check() ==

                activate &quot;Spark driver&quot;
                &quot;Spark driver&quot; -&gt; &quot;Greenplum master&quot; ++ : CONNECT

                &quot;Spark driver&quot; --&gt; &quot;Greenplum master&quot; : CHECK IF TABLE EXISTS gp_table
                &quot;Greenplum master&quot; --&gt; &quot;Spark driver&quot; : TABLE EXISTS
                &quot;Spark driver&quot; -&gt; &quot;Greenplum master&quot; : SHOW SCHEMA FOR gp_table
                &quot;Greenplum master&quot; --&gt; &quot;Spark driver&quot; : (id bigint, col1 int, col2 text, ...)

                == DBReader.run() ==

                &quot;Spark driver&quot; -&gt; &quot;Spark executor1&quot; ++ : START EXECUTOR FOR df(id bigint, col1 int, col2 text, ...) PARTITION 1
                &quot;Spark driver&quot; -&gt; &quot;Spark executor2&quot; ++ : START EXECUTOR FOR df(id bigint, col1 int, col2 text, ...) PARTITION 2
                &quot;Spark driver&quot; -&gt; &quot;Spark executorN&quot; ++ : START EXECUTOR FOR df(id bigint, col1 int, col2 text, ...) PARTITION N

                note right of &quot;Spark driver&quot; : This is done in parallel,\nexecutors are independent\n|\n|\n|\nV
                &quot;Spark executor1&quot; -&gt; &quot;Greenplum master&quot; ++ : CREATE WRITABLE EXTERNAL TABLE spark_executor1 (id bigint, col1 int, col2 text, ...) USING address=executor1_host:executor1_port;\nINSERT INTO EXTERNAL TABLE spark_executor1 FROM gp_table WHERE gp_segment_id = 1
                note right of &quot;Greenplum master&quot; : Each white vertical line here is a opened connection to master.\nUsually, **N+1** connections are created from Spark to Greenplum master
                &quot;Greenplum master&quot; --&gt; &quot;Greenplum segment1&quot; ++ : SELECT DATA FROM gp_table_data_on_segment1 TO spark_executor1
                note right of &quot;Greenplum segment1&quot; : No direct requests between Greenplum segments &amp; Spark.\nData transfer is always initiated by Greenplum segments.

                &quot;Spark executor2&quot; -&gt; &quot;Greenplum master&quot; ++ : CREATE WRITABLE EXTERNAL TABLE spark_executor2 (id bigint, col1 int, col2 text, ...) USING address=executor2_host:executor2_port;\nINSERT INTO EXTERNAL TABLE spark_executor2 FROM gp_table WHERE gp_segment_id = 2
                &quot;Greenplum master&quot; --&gt; &quot;Greenplum segment2&quot; ++ : SELECT DATA FROM gp_table_data_on_segment2 TO spark_executor2

                &quot;Spark executorN&quot; -&gt; &quot;Greenplum master&quot; ++ : CREATE WRITABLE EXTERNAL TABLE spark_executorN (id bigint, col1 int, col2 text, ...) USING address=executorN_host:executorN_port;\nINSERT INTO EXTERNAL TABLE spark_executorN FROM gp_table WHERE gp_segment_id = N
                &quot;Greenplum master&quot; --&gt; &quot;Greenplum segmentN&quot; ++ : SELECT DATA FROM gp_table_data_on_segmentN TO spark_executorN

                &quot;Greenplum segment1&quot; -&gt;o &quot;Spark executor1&quot; -- : INITIALIZE CONNECTION TO Spark executor1\nPUSH DATA TO Spark executor1
                note left of &quot;Spark executor1&quot; : Circle is an open GPFDIST port,\nlistened by executor

                &quot;Greenplum segment2&quot; -&gt;o &quot;Spark executor2&quot; -- : INITIALIZE CONNECTION TO Spark executor2\nPUSH DATA TO Spark executor2
                &quot;Greenplum segmentN&quot; -&gt;o &quot;Spark executorN&quot; -- : INITIALIZE CONNECTION TO Spark executorN\nPUSH DATA TO Spark executorN

                == Spark.stop() ==

                &quot;Spark executor1&quot; --&gt; &quot;Greenplum master&quot; : DROP TABLE spark_executor1
                deactivate &quot;Greenplum master&quot;
                &quot;Spark executor2&quot; --&gt; &quot;Greenplum master&quot; : DROP TABLE spark_executor2
                deactivate &quot;Greenplum master&quot;
                &quot;Spark executorN&quot; --&gt; &quot;Greenplum master&quot; : DROP TABLE spark_executorN
                deactivate &quot;Greenplum master&quot;

                &quot;Spark executor1&quot; --&gt; &quot;Spark driver&quot; -- : DONE
                &quot;Spark executor2&quot; --&gt; &quot;Spark driver&quot; -- : DONE
                &quot;Spark executorN&quot; --&gt; &quot;Spark driver&quot; -- : DONE

                &quot;Spark driver&quot; --&gt; &quot;Greenplum master&quot; : CLOSE CONNECTION
                deactivate &quot;Greenplum master&quot;
                deactivate &quot;Spark driver&quot;
        @enduml
</code></pre></div>
<h2 id="recommendations">Recommendations<a class="headerlink" href="#recommendations" title="Permanent link">&para;</a></h2>
<h3 id="select-only-required-columns">Select only required columns<a class="headerlink" href="#select-only-required-columns" title="Permanent link">&para;</a></h3>
<p>Instead of passing <code>"*"</code> in <code>DBReader(columns=[...])</code> prefer passing exact column names. This reduces the amount of data passed from Greenplum to Spark.</p>
<h3 id="pay-attention-to-where-value">Pay attention to <code>where</code> value<a class="headerlink" href="#pay-attention-to-where-value" title="Permanent link">&para;</a></h3>
<p>Instead of filtering data on Spark side using <code>df.filter(df.column == 'value')</code> pass proper <code>DBReader(where="column = 'value'")</code> clause.
This both reduces the amount of data send from Greenplum to Spark, and may also improve performance of the query.
Especially if there are indexes or partitions for columns used in <code>where</code> clause.</p>
<h3 id="read-data-in-parallel">Read data in parallel<a class="headerlink" href="#read-data-in-parallel" title="Permanent link">&para;</a></h3>
<p><code>DBReader</code> in case of Greenplum connector requires view or table to have a column which is used by Spark
for parallel reads.</p>
<p>Choosing proper column allows each Spark executor to read only part of data stored in the specified segment,
avoiding moving large amounts of data between segments, which improves reading performance.</p>
<h4 id="using-gp_segment_id">Using <code>gp_segment_id</code><a class="headerlink" href="#using-gp_segment_id" title="Permanent link">&para;</a></h4>
<p>By default, <code>DBReader</code> will use <a href="https://docs.vmware.com/en/VMware-Greenplum-Connector-for-Apache-Spark/2.3/greenplum-connector-spark/troubleshooting.html#reading-from-a-view">gp_segment_id</a>
column for parallel data reading. Each DataFrame partition will contain data of a specific Greenplum segment.</p>
<p>This allows each Spark executor read only data from specific Greenplum segment, avoiding moving large amounts of data between segments.</p>
<p>If view is used, it is recommended to include <code>gp_segment_id</code> column to this view:</p>
<div class="highlight"><pre><span></span><code>.. dropdown:: Reading from view with gp_segment_id column

    .. code-block:: python

        from onetl.connection import Greenplum
        from onetl.db import DBReader

        greenplum = Greenplum(...)

        greenplum.execute(
            &quot;&quot;&quot;
            CREATE VIEW schema.view_with_gp_segment_id AS
            SELECT
                id,
                some_column,
                another_column,
                gp_segment_id  -- IMPORTANT
            FROM schema.some_table
            &quot;&quot;&quot;,
        )

        reader = DBReader(
            connection=greenplum,
            source=&quot;schema.view_with_gp_segment_id&quot;,
        )
        df = reader.run()
</code></pre></div>
<h4 id="using-custom-partition_column">Using custom <code>partition_column</code><a class="headerlink" href="#using-custom-partition_column" title="Permanent link">&para;</a></h4>
<p>Sometimes table or view is lack of <code>gp_segment_id</code> column, but there is some column
with value range correlated with Greenplum segment distribution.</p>
<p>In this case, custom column can be used instead:</p>
<div class="highlight"><pre><span></span><code>.. dropdown:: Reading from view with custom partition_column

    .. code-block:: python

        from onetl.connection import Greenplum
        from onetl.db import DBReader

        greenplum = Greenplum(...)

        greenplum.execute(
            &quot;&quot;&quot;
            CREATE VIEW schema.view_with_partition_column AS
            SELECT
                id,
                some_column,
                part_column  -- correlated to greenplum segment ID
            FROM schema.some_table
            &quot;&quot;&quot;,
        )

        reader = DBReader(
            connection=greenplum,
            source=&quot;schema.view_with_partition_column&quot;,
            options=Greenplum.ReadOptions(
                # parallelize data using specified column
                partitionColumn=&quot;part_column&quot;,
                # create 10 Spark tasks, each will read only part of table data
                partitions=10,
            ),
        )
        df = reader.run()
</code></pre></div>
<h4 id="reading-distributed-replicated-tables">Reading <code>DISTRIBUTED REPLICATED</code> tables<a class="headerlink" href="#reading-distributed-replicated-tables" title="Permanent link">&para;</a></h4>
<p>Replicated tables do not have <code>gp_segment_id</code> column at all, so you need to set <code>partition_column</code> to some column name
of type integer/bigint/smallint.</p>
<h3 id="parallel-join-execution">Parallel <code>JOIN</code> execution<a class="headerlink" href="#parallel-join-execution" title="Permanent link">&para;</a></h3>
<p>In case of using views which require some data motion between Greenplum segments, like <code>JOIN</code> queries, another approach should be used.</p>
<p>Each Spark executor N will run the same query, so each of N query will start its own JOIN process, leading to really heavy load on Greenplum segments.
<strong>This should be avoided</strong>.</p>
<p>Instead is recommended to run <code>JOIN</code> query on Greenplum side, save the result to an intermediate table,
and then read this table using <code>DBReader</code>:</p>
<div class="highlight"><pre><span></span><code>.. dropdown:: Reading from view using intermediate table

    .. code-block:: python

        from onetl.connection import Greenplum
        from onetl.db import DBReader

        greenplum = Greenplum(...)

        greenplum.execute(
            &quot;&quot;&quot;
            CREATE UNLOGGED TABLE schema.intermediate_table AS
            SELECT
                id,
                tbl1.col1,
                tbl1.data,
                tbl2.another_data
            FROM
                schema.table1 as tbl1
            JOIN
                schema.table2 as tbl2
            ON
                tbl1.col1 = tbl2.col2
            WHERE ...
            &quot;&quot;&quot;,
        )

        reader = DBReader(
            connection=greenplum,
            source=&quot;schema.intermediate_table&quot;,
        )
        df = reader.run()

        # write dataframe somethere

        greenplum.execute(
            &quot;&quot;&quot;
            DROP TABLE schema.intermediate_table
            &quot;&quot;&quot;,
        )
</code></pre></div>
<div class="highlight"><pre><span></span><code>.. warning::

    **NEVER** do that:

    .. code-block:: python

        df1 = DBReader(connection=greenplum, target=&quot;public.table1&quot;, ...).run()
        df2 = DBReader(connection=greenplum, target=&quot;public.table2&quot;, ...).run()

        joined_df = df1.join(df2, on=&quot;col&quot;)

    This will lead to sending all the data from both ``table1`` and ``table2`` to Spark executor memory, and then ``JOIN``
    will be performed on Spark side, not inside Greenplum. This is **VERY** inefficient.
</code></pre></div>
<h4 id="temporary-tables-notice"><code>TEMPORARY</code> tables notice<a class="headerlink" href="#temporary-tables-notice" title="Permanent link">&para;</a></h4>
<p>Someone could think that writing data from view or result of <code>JOIN</code> to <code>TEMPORARY</code> table,
and then passing it to <code>DBReader</code>, is an efficient way to read data from Greenplum. This is because temp tables are not generating WAL files,
and are automatically deleted after finishing the transaction.</p>
<p>That will <strong>NOT</strong> work. Each Spark executor establishes its own connection to Greenplum.
And each connection starts its own transaction which means that every executor will read empty temporary table.</p>
<p>You should use <a href="https://docs.vmware.com/en/VMware-Greenplum/7/greenplum-database/ref_guide-sql_commands-CREATE_TABLE.html">UNLOGGED</a> tables
to write data to intermediate table without generating WAL logs.</p>
<h2 id="options">Options<a class="headerlink" href="#options" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>.. currentmodule:: onetl.connection.db_connection.greenplum.options
</code></pre></div>
<div class="highlight"><pre><span></span><code>.. autopydantic_model:: GreenplumReadOptions
    :member-order: bysource
    :model-show-field-summary: false
    :field-show-constraints: false
</code></pre></div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.indexes", "content.tabs.link", "content.code.copy", "content.code.select"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../../../assets/mkdocs_puml/puml.js"></script>
      
        <script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
      
        <script src="../../../../assets/mkdocs_puml/interaction.js"></script>
      
    
  </body>
</html>